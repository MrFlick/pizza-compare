<html>
    <head>
        <link href="https://fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet">
        <style>
            body { 
                background-color: #36B1BF;
                text-align:center;
                font-family: 'Fjalla One', sans-serif;}
            body p {font-family: 'Georgia', serif}
            section div {width: 100%}

            body > div {background-color: #E9F1DF;
                margin: 20px auto; width: 500px; 
                box-shadow: 0px 0px 50px 0px rgba(0, 0, 0, 0.2);
                padding: 5px}

            section div.half {width: 50%; float: left;}
            section .pizzabox {position: relative;}
            section .pizzabox span {position: absolute;
                color: white; font-size: 36px;
                text-shadow:
                    -1px -1px 0 #000,  
                    1px -1px 0 #000,
                    -1px 1px 0 #000,
                    1px 1px 0 #000;
                top: 50%; left: 50%; transform: translate(-50%, -50%);}

            .clearfix::after {
                content: "";
                clear: both;
                display: table;
            }
        </style>
        <script>
            if (!Array.isArray) {
                Array.isArray = function(arg) {
                    return Object.prototype.toString.call(arg) === '[object Array]';
                };
            }
            function removeChildren(node) {
                while (node.hasChildNodes()) {
                    node.removeChild(node.lastChild);
                }
            }
            var defaultSettings = {
                inchToPixel: 10,
                padding: 5,
                pizza1Color: "#F2454B",
                pizza2Color: "#F5B634"
            };
            var state = {
                pizza1: 8,
                pizza2: 12,
                refPrice: 15,
                refPizza: 1
            }
            function gcd(a,b){
                return b ? gcd(b, a%b) : a;
            }
            function loadFracs() {
                var result = []
                result.push({val: 0, desc: "0"})
                var denoms = [2, 3, 4, 5, 6, 8, 10, 16];
                for(var i=0; i<denoms.length; i++) {
                    var d = denoms[i];
                    for(var n=1; n<d; n++) {
                        if (gcd(n,d)>1) {
                            continue;
                        }
                        result.push({val: n/d, desc: n+"/"+d})
                    }
                }
                return result.sort(function(a,b) {return a.val-b.val})
            }
            defaultSettings.fracs = loadFracs()
            function nearestFrac(x, fracs) {
                var diff = Math.abs(x - fracs[0].val);
                var i = 0;
                while( Math.abs(x - fracs[i+1].val) < diff && i<fracs.length-2) {
                    diff = x-fracs[i+1].val
                    i++
                }
                return fracs[i];
            }
            function getMultiplier(x, fracs) {
                var base = Math.floor(x)
                var dec = x - base
                var nearest = nearestFrac(dec, fracs)
                var approx = true;
                if(Math.abs(nearest.val-dec)<.0001) {
                    approx = false;
                }
                return ((approx) ? "~" : "") + 
                    [((base>0) ? base : ""),
                    ((nearest.val!=0) ? nearest.desc : "")].join(" ")
            }
            function getPercent(x) {
                var dec = (x*100) % 1
                var approx = false
                if (dec > .01) {
                    approx = true
                }
                return ((approx)?"~":"") + (x*100).toFixed(0) + "%"
            }
            function addSliceToMatchArea(stats) {
                var result = [];
                var growthFactor = stats.growthFactor;
                var pies = Math.floor(growthFactor);
                var slice = growthFactor-Math.floor(growthFactor);
                for (var i=0; i<pies; i++) {
                    result.push(Object.assign({}, stats.smallerPizza))
                }
                if (slice > .001) {
                    var pizza = Object.assign({}, stats.smallerPizza)
                    pizza.slices = [{p: slice}]
                    result.push(pizza)
                }
                return result
            }
            function getMatchingText(stats, settings) {
                var growthFactor = stats.growthFactor;
                if (growthFactor<=1) return ""
                return "You can make " + 
                    getMultiplier(growthFactor, settings.fracs) +
                    " smaller pizzas from the larger pizza."          
            }
            function markAdditionalSlice(stats) {
                var existingProp = stats.existingProp;
                var slices = [];
                slices.push({p: existingProp, color: stats.smallerPizza.color})
                slices.push({p: 1-existingProp, color: stats.largerPizza.color})
                var pizza = Object.assign({}, stats.largerPizza)
                pizza.slices = slices;
                return pizza
            }
            function getAdditionalText(stats) {
                var existingProp = stats.existingProp;
                if (existingProp >= 1) return ""
                return "The smaller pizza would take up  " + 
                    getPercent(existingProp) +
                    " of the larger pizza."
            }
            function buildPizzas(pizzas, settings) {
                var result = document.createDocumentFragment()

                if (!Array.isArray(pizzas)) {
                    pizzas = [pizzas]
                }

                pizzas.forEach(function(pizza) {
                    var canvas = document.createElement("canvas")
                    var size = pizza.diameter * settings.inchToPixel
                    canvas.width = size + settings.padding;
                    canvas.height = size + settings.padding;
                    var ctx = canvas.getContext("2d")

                    ctx.translate(canvas.width/2, canvas.height/2);
                    if (!pizza.slices) {
                        pizza.slices = [{p: 1}]
                    }
                    var radius = size/2;
                    var pOffset = -Math.PI/2;
                    pizza.slices.forEach(function(slice) {
                        ctx.beginPath();
                        ctx.moveTo(0, 0)
                        ctx.arc(0, 0, radius, pOffset + 0,
                                pOffset + 2*Math.PI * slice.p);
                        ctx.lineTo(0, 0)
                        ctx.fillStyle = slice.color || pizza.color;
                        ctx.fill();
                        pOffset += slice.p * 2*Math.PI
                    })
                    result.appendChild(canvas);
                })
                return result;
            }

            function swapPriceRef () {
                state.refPizza = (state.refPizza==1) ? 2 : 1
                updatePrices()
            }

            function updatePrice() {
                var price = document.getElementById("refprice").value
                state.refPrice = price
                updatePrices()
            }

            function updatePrices() {
                var p1box = document.getElementById("pizza1price")
                var p2box = document.getElementById("pizza2price")
                var input = document.getElementById("refprice")
                var output = document.getElementById("otherprice")
                var factor = 1
                if (state.refPizza==1) {
                    if (input.parentElement != p1box) {
                        input.parentElement.removeChild(input)
                        p1box.appendChild(input)
                        output.parentElement.removeChild(output)
                        p2box.appendChild(output)
                    }
                    factor = Math.pow(state.pizza2/2,2)/Math.pow(state.pizza1/2,2)
                } else {
                    if (input.parentElement != p2box) {
                        input.parentElement.removeChild(input)
                        p2box.appendChild(input)
                        output.parentElement.removeChild(output)
                        p1box.appendChild(output)
                    }
                    factor = Math.pow(state.pizza1/2,2)/Math.pow(state.pizza2/2,2)
                }
                input.value = state.refPrice
                var price =  parseFloat(state.refPrice)
                output.innerText = (price) ? (factor * price).toLocaleString(undefined, { style: 'currency', currency: 'USD' }) : "??"
            }

            function drawPizzas() {
                var settings = Object.assign({}, defaultSettings)
                var stats = calcStats(state)
                
                if (stats.largerPizza.diameter * settings.inchToPixel>500/2) {
                    settings.inchToPixel = (500/2)/stats.largerPizza.diameter
                }
                function update(id, pizza) {
                    var objs = buildPizzas(pizza, settings)
                    var node = document.getElementById(id)
                    removeChildren(node)
                    node.appendChild(objs)
                }
                function updateText(id, text) {
                    document.getElementById(id).innerText = text
                }
                update("pizza1pic", stats.pizza1)
                updateText("pizza1label", stats.pizza1.diameter + "\"")
                update("pizza2pic", stats.pizza2)
                updateText("pizza2label", stats.pizza2.diameter + "\"")
                update("extendsmaller", addSliceToMatchArea(stats))
                updateText("extendsmallertext", getMatchingText(stats, settings))
                update("removesmaller", markAdditionalSlice(stats))
                updateText("removesmallertext", getAdditionalText(stats))
            }

            function calcStats(state) {
                var stats = {}
                function calcArea(p) {
                    p.propArea = Math.pow(p.diameter/2, 2)
                    p.area = p.propArea * Math.PI
                }
                stats.pizza1 = {
                    diameter: state.pizza1,
                    color: defaultSettings.pizza1Color
                }
                stats.pizza2 = {
                    diameter: state.pizza2,
                    color: defaultSettings.pizza2Color
                }
                calcArea(stats.pizza1)
                calcArea(stats.pizza2)
                if (stats.pizza1.diameter < stats.pizza2.diameter) {
                    stats.smallerPizza = stats.pizza1
                    stats.largerPizza = stats.pizza2
                } else {
                    stats.smallerPizza = stats.pizza2
                    stats.largerPizza = stats.pizza1
                }
                stats.existingProp = stats.smallerPizza.propArea/
                    stats.largerPizza.propArea
                stats.growthFactor = stats.largerPizza.propArea/
                    stats.smallerPizza.propArea
                return stats
            }

            function updatePizzas() {
                var p1 = parseInt(document.getElementById("pizza1").value);
                var p2 = parseInt(document.getElementById("pizza2").value);
                state.pizza1 = p1
                state.pizza2 = p2
                drawPizzas()
                updatePrices()
            }

            function init() {
                var p1 = document.getElementById("pizza1")
                p1.addEventListener("input", updatePizzas)
                p1.value = state.pizza1
                var p2 = document.getElementById("pizza2")
                p2.addEventListener("input", updatePizzas)
                p2.value = state.pizza2
                var swap = document.getElementById("swapprice")
                swap.addEventListener("click", swapPriceRef)
                var price = document.getElementById("refprice")
                price.value = state.refPrice
                price.addEventListener("input", updatePrice)
                updatePizzas()
                updatePrices()
            }

        </script>
    </head>
    <body onload="init()"><div>
        <h1>More Pizza?</h1>
            <section>
                <p>This visualization will allow you to compare two different
                    pizza sizes to see how much more/less pizza you get when
                    actually comparing the surface area.
                </p>
            </section>
            <section>
                <div class="clearfix">
                    <div class="half">
                        <h2>Pizza 1</h2>
                        <input type="range" min="1" max="36" class="slider" id="pizza1">
                        <div class="pizzabox">
                            <div id="pizza1pic"></div>
                            <span id="pizza1label"></span>
                        </div>
                    </div>
                    <div class="half">
                        <h2>Pizza 2</h2>
                        <input type="range" min="1" max="36" class="slider" id="pizza2">
                        <div class="pizzabox">
                            <div id="pizza2pic"></div>
                            <span id="pizza2label"></span>
                        </div>
                    </div>
                </div>
            </section>
            <section>
                <div>
                    <h3>How many smaller pizzas can be made from larger pizza?</h3>
                    <div id="extendsmaller"></div>
                    <p id="extendsmallertext"></p>
                </div>
            </section>
            <section>
                <div>
                    <h3>Where would the smaller pizza fit in the larger?</h3>
                    <div id="removesmaller"></div>
                    <p id="removesmallertext"></p>
                </div>
            </section>
            <section>
                <div>
                <h3>What if prices were proportional to area?</h3>
                <div class="clearfix">
                    <div class="half">
                        <p>Cost of Pizza 1</p>
                        <div id="pizza1price">
                            <input type="text" id="refprice" size=10/>
                        </div>
                    </div>
                    <div class="half">
                        <p>Cost of Pizza 2</p>
                        <div id="pizza2price">
                            <span id="otherprice">$0.00</span>
                        </div>
                    </div>
                </div>
                <button id="swapprice">&lt;- Switch input -&gt;</button>
                </div>
            </section>
            <section></section>
    </div></body>
</html>